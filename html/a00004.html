<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>rl-3.00.03: example-000-003-agents.cc</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">rl-3.00.03
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">example-000-003-agents.cc</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/*   This file is part of rl-lib</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   Copyright (C) 2010,  Supelec</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   Author : Herve Frezza-Buet and Matthieu Geist</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   Contributor :</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   This library is free software; you can redistribute it and/or</span></div>
<div class="line"><span class="comment"> *   modify it under the terms of the GNU General Public</span></div>
<div class="line"><span class="comment"> *   License (GPL) as published by the Free Software Foundation; either</span></div>
<div class="line"><span class="comment"> *   version 3 of the License, or any later version.</span></div>
<div class="line"><span class="comment"> *   </span></div>
<div class="line"><span class="comment"> *   This library is distributed in the hope that it will be useful,</span></div>
<div class="line"><span class="comment"> *   but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><span class="comment"> *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU</span></div>
<div class="line"><span class="comment"> *   General Public License for more details.</span></div>
<div class="line"><span class="comment"> *   </span></div>
<div class="line"><span class="comment"> *   You should have received a copy of the GNU General Public</span></div>
<div class="line"><span class="comment"> *   License along with this library; if not, write to the Free Software</span></div>
<div class="line"><span class="comment"> *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   Contact : Herve.Frezza-Buet@supelec.fr Matthieu.Geist@supelec.fr</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// First, you have to include the rllib header file, and the other</span></div>
<div class="line"><span class="comment">// usual includes that you may need.</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="a00070.html">rl.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iomanip&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;array&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// In the rl library, there are ready to use templates for building</span></div>
<div class="line"><span class="comment">// agents. An agent is something that knows what to do when it is</span></div>
<div class="line"><span class="comment">// given a state. In other words, it implements a policy.</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// We will consider here agents built from an available Q-Value</span></div>
<div class="line"><span class="comment">// representation. This Q-Value is the actual critic. Here, we will</span></div>
<div class="line"><span class="comment">// consider a n-armed bandit problem, where the Q value are related</span></div>
<div class="line"><span class="comment">// to a single state. The critic is then only an evaluation of each</span></div>
<div class="line"><span class="comment">// arm (the actions are &quot;play with arm #i&quot;). </span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">typedef</span> <span class="keywordtype">int</span>                         S; <span class="comment">// a dummy state here</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keywordtype">int</span>                         A; <span class="comment">// An action is the arm number (from 0)</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keywordtype">double</span>                      Reward;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// This implements a Q function... the class behaves as any function.</span></div>
<div class="line"><span class="preprocessor">#define NB_ARMS 50</span></div>
<div class="line"><span class="preprocessor"></span><span class="keyword">class </span>Q {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="comment">// Here is a reference to our stored Q values</span></div>
<div class="line">  std::array&lt;double,NB_ARMS&gt;&amp; tabular_values;</div>
<div class="line"></div>
<div class="line">  Q(std::array&lt;double,NB_ARMS&gt;&amp; q_values) : tabular_values(q_values) {}</div>
<div class="line"></div>
<div class="line">  <span class="comment">// This is mandatory since rl::policy::softmax stores a copy of q.</span></div>
<div class="line">  Q(<span class="keyword">const</span> Q&amp; cp) : tabular_values(cp.tabular_values) {}</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">double</span> operator()(S s, A a)<span class="keyword"> const </span>{<span class="keywordflow">return</span> tabular_values[a];}</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// Let us define functions for plotting histograms</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define HISTO_NB_SAMPLES 20000</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> POLICY&gt;</div>
<div class="line"><span class="keywordtype">void</span> plot1D(std::string title,<span class="keyword">const</span> POLICY&amp; policy,std::string filename) {</div>
<div class="line">  std::ofstream file;</div>
<div class="line"></div>
<div class="line">  file.open(filename.c_str());</div>
<div class="line">  <span class="keywordflow">if</span>(!file) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Cannot open \&quot;&quot;</span> &lt;&lt; file &lt;&lt; <span class="stringliteral">&quot;\&quot;. Aborting&quot;</span>;</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">int</span> histogram[NB_ARMS];</div>
<div class="line">  A a;</div>
<div class="line">  S dummy;</div>
<div class="line">  <span class="keywordtype">int</span> i;</div>
<div class="line">  <span class="keywordtype">double</span> <a name="a0"></a><a class="code" href="a00084.html#a214b9f809cccad42afa661f6afff22e0">max</a>=0;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span>(a = 0; a &lt; NB_ARMS; ++a)</div>
<div class="line">    histogram[a] = 0;</div>
<div class="line">  <span class="keywordflow">for</span>(i = 0; i &lt; HISTO_NB_SAMPLES; ++i)</div>
<div class="line">    histogram[policy(dummy)]++;</div>
<div class="line">  <span class="keywordflow">for</span>(a = 0; a &lt; NB_ARMS; ++a)</div>
<div class="line">    <span class="keywordflow">if</span>(histogram[a] &gt; max)</div>
<div class="line">      max = histogram[a];</div>
<div class="line">  max /= (double)HISTO_NB_SAMPLES;</div>
<div class="line">  file &lt;&lt; <span class="stringliteral">&quot;set title &#39;&quot;</span> &lt;&lt; title &lt;&lt; <span class="stringliteral">&quot;&#39;;&quot;</span> &lt;&lt; std::endl</div>
<div class="line">       &lt;&lt; <span class="stringliteral">&quot;set xrange [0:&quot;</span> &lt;&lt; NB_ARMS-1 &lt;&lt; <span class="stringliteral">&quot;];&quot;</span> &lt;&lt; std::endl</div>
<div class="line">       &lt;&lt; <span class="stringliteral">&quot;set yrange [0:&quot;</span> &lt;&lt; max*1.1 &lt;&lt; <span class="stringliteral">&quot;];&quot;</span> &lt;&lt; std::endl</div>
<div class="line">       &lt;&lt; <span class="stringliteral">&quot;set xlabel &#39;Actions&#39;&quot;</span> &lt;&lt; std::endl</div>
<div class="line">       &lt;&lt; <span class="stringliteral">&quot;plot &#39;-&#39; with lines notitle&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  <span class="keywordflow">for</span>(a = 0; a &lt; NB_ARMS; ++a)</div>
<div class="line">    file &lt;&lt; a &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; histogram[a]/(<span class="keywordtype">double</span>)HISTO_NB_SAMPLES &lt;&lt; std::endl;</div>
<div class="line"></div>
<div class="line">  file.close();</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span> &lt;&lt; filename &lt;&lt; <span class="stringliteral">&quot;\&quot; generated.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> POLICY&gt;</div>
<div class="line"><span class="keywordtype">void</span> plot2D(POLICY&amp; policy) {</div>
<div class="line">  std::ofstream file;</div>
<div class="line"></div>
<div class="line">  file.open(<span class="stringliteral">&quot;SoftMaxPolicy.plot&quot;</span>);</div>
<div class="line">  <span class="keywordflow">if</span>(!file) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Cannot open \&quot;SoftMaxPolicy.plot\&quot;. Aborting&quot;</span>;</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">int</span> histogram[NB_ARMS];</div>
<div class="line">  A a;</div>
<div class="line">  S dummy;</div>
<div class="line">  <span class="keywordtype">int</span> i;</div>
<div class="line">  <span class="keywordtype">int</span> tpt;</div>
<div class="line">  <span class="keywordtype">double</span> temperature;</div>
<div class="line"></div>
<div class="line">  file &lt;&lt; <span class="stringliteral">&quot;set title &#39;SoftMax policy action choices&#39;;&quot;</span> &lt;&lt; std::endl</div>
<div class="line">       &lt;&lt; <span class="stringliteral">&quot;set xrange [0:&quot;</span> &lt;&lt; NB_ARMS-1 &lt;&lt; <span class="stringliteral">&quot;];&quot;</span> &lt;&lt; std::endl</div>
<div class="line">       &lt;&lt; <span class="stringliteral">&quot;set xlabel &#39;Temperature&#39;&quot;</span> &lt;&lt; std::endl</div>
<div class="line">       &lt;&lt; <span class="stringliteral">&quot;set ylabel &#39;Actions&#39;&quot;</span> &lt;&lt; std::endl</div>
<div class="line">       &lt;&lt; <span class="stringliteral">&quot;set hidden3d;&quot;</span> &lt;&lt; std::endl</div>
<div class="line">       &lt;&lt; <span class="stringliteral">&quot;set ticslevel 0;&quot;</span> &lt;&lt; std::endl</div>
<div class="line">       &lt;&lt; <span class="stringliteral">&quot;splot &#39;-&#39; using 1:2:3 with lines notitle&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  <span class="keywordflow">for</span>(tpt = 0, policy.temperature = 100; </div>
<div class="line">      tpt &lt; 50; </div>
<div class="line">      file &lt;&lt; std::endl, policy.temperature *= .85, ++tpt) {</div>
<div class="line">    <span class="keywordflow">for</span>(a = 0; a &lt; NB_ARMS; ++a)</div>
<div class="line">      histogram[a] = 0;</div>
<div class="line">    <span class="keywordflow">for</span>(i = 0; i &lt; HISTO_NB_SAMPLES; ++i)</div>
<div class="line">      histogram[policy(dummy)]++;</div>
<div class="line">    <span class="keywordflow">for</span>(a = 0; a &lt; NB_ARMS; ++a)</div>
<div class="line">      file &lt;&lt; tpt &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; a &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; histogram[a]/(<span class="keywordtype">double</span>)HISTO_NB_SAMPLES &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;line &quot;</span> &lt;&lt; std::setw(3) &lt;&lt; tpt+1 &lt;&lt; <span class="stringliteral">&quot;/50 generated.   \r&quot;</span> &lt;&lt; std::flush;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  file.close();</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;\&quot;SoftMaxPolicy.plot\&quot; generated.                 &quot;</span> &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[]) {</div>
<div class="line">  std::array&lt;double,NB_ARMS&gt; q_tab;     <span class="comment">// tabular values...</span></div>
<div class="line">  Q                          q(q_tab);  <span class="comment">// ...q handle them.</span></div>
<div class="line">  A                          a;</div>
<div class="line">  <span class="keywordtype">double</span>                     x;</div>
<div class="line"></div>
<div class="line">  <a name="_a1"></a><a class="code" href="a00024.html">rl::enumerator&lt;A&gt;</a> a_begin(0);</div>
<div class="line">  <a class="code" href="a00024.html">rl::enumerator&lt;A&gt;</a> a_end(NB_ARMS);</div>
<div class="line"></div>
<div class="line">  <span class="keyword">auto</span> random_policy         = <a name="a2"></a><a class="code" href="a00090.html#a0865efbab1fec9daf8877565a6cba328">rl::policy::random</a>(a_begin,a_end);</div>
<div class="line">  <span class="keyword">auto</span> greedy_policy         = <a name="a3"></a><a class="code" href="a00090.html#af10340b31ffcb30a861db1db50092efd">rl::policy::greedy</a>(q,a_begin,a_end);</div>
<div class="line">  <span class="keyword">auto</span> epsilon_greedy_policy = <a name="a4"></a><a class="code" href="a00090.html#a07bf704a9d12c4ca28abe0e13c5dbe05">rl::policy::epsilon_greedy</a>(q,.75,</div>
<div class="line">                                                          a_begin,a_end);</div>
<div class="line">  <span class="keyword">auto</span> softmax_policy        = <a name="a5"></a><a class="code" href="a00090.html#a5850ffc5e3851a5dbc3992ff8ca872c5">rl::policy::softmax</a>(q,0,</div>
<div class="line">                                                   a_begin,a_end);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">try</span> {</div>
<div class="line">    <span class="comment">// Let us initialize the values with a bi-modal distribution...</span></div>
<div class="line">    <span class="comment">// I have found it empirically while playing with gnuplot.</span></div>
<div class="line">    <span class="keywordflow">for</span>(a = 0; a &lt; NB_ARMS; ++a) {</div>
<div class="line">      x = a/(double)NB_ARMS;</div>
<div class="line">      q.tabular_values[a] = (1-.2*x)*pow(sin(5*(x+.15)),2);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Let us plot histograms of policys.</span></div>
<div class="line">    plot1D(<span class="stringliteral">&quot;Random policy choices&quot;</span>,random_policy,<span class="stringliteral">&quot;RandomPolicy.plot&quot;</span>);</div>
<div class="line">    plot1D(<span class="stringliteral">&quot;Greedy policy choices&quot;</span>,greedy_policy,<span class="stringliteral">&quot;GreedyPolicy.plot&quot;</span>);</div>
<div class="line">    plot1D(<span class="stringliteral">&quot;Epsilon-greedy policy choices&quot;</span>,epsilon_greedy_policy,<span class="stringliteral">&quot;EpsilonGreedyPolicy.plot&quot;</span>);</div>
<div class="line"></div>
<div class="line">    plot2D(softmax_policy);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">catch</span>(<a name="_a6"></a><a class="code" href="a00025.html">rl::exception::Any</a>&amp; e) {</div>
<div class="line">    std::cerr &lt;&lt; e.<a name="a7"></a><a class="code" href="a00025.html#aa1b46c0792aa79cc5cc57e281db0c70c">what</a>() &lt;&lt; std::endl;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
